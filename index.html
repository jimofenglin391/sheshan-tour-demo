<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¸Šæµ·ç¯çƒæ¸¯â†’ä½˜å±±å®šå‘æ—…æ¸¸å°æ¸¸æˆï¼ˆå®Œæ•´åœ°å›¾ç‰ˆï¼‰</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: "Microsoft Yahei", sans-serif;
        }
        body {
            background: #f5f5f5;
            overflow-x: hidden;
            padding-bottom: 20px;
        }
        /* æµç¨‹å®¹å™¨ */
        .process-container {
            width: 90%;
            max-width: 1200px;
            margin: 20px auto;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        /* æ­¥éª¤æ¡ */
        .step-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: relative;
            padding: 0 20px;
        }
        .step-bar::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 0;
            width: 100%;
            height: 3px;
            background: #e0e0e0;
            z-index: 1;
            transform: translateY(-50%);
        }
        .step-bar::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 0;
            height: 3px;
            background: #2ecc71;
            z-index: 2;
            transform: translateY(-50%);
            transition: width 0.5s ease;
        }
        .step-bar.step-1::after { width: 0%; }
        .step-bar.step-2::after { width: 50%; }
        .step-bar.step-3::after { width: 100%; }
        .step-item {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: white;
            border: 3px solid #e0e0e0;
            color: #999;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            position: relative;
            z-index: 3;
            transition: all 0.3s ease;
        }
        .step-item.active {
            background: #2ecc71;
            border-color: #2ecc71;
            color: white;
        }
        .step-item.done {
            background: #2ecc71;
            border-color: #2ecc71;
            color: white;
        }
        .step-item .step-name {
            position: absolute;
            top: 50px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 14px;
            color: #666;
            white-space: nowrap;
        }
        /* å¯¼èˆªæ  */
        .nav {
            display: flex;
            justify-content: center;
            align-items: center;
            background: #2c3e50;
            padding: 15px 0;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .nav-btn {
            color: white;
            background: #3498db;
            border: none;
            padding: 10px 20px;
            margin: 0 10px;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 14px;
            font-weight: 500;
        }
        .nav-btn.active {
            background: #2ecc71;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(46, 204, 113, 0.3);
        }
        .nav-btn.disabled {
            background: #95a5a6;
            cursor: not-allowed;
            opacity: 0.6;
        }
        .nav-btn:not(.disabled):hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(52, 152, 219, 0.3);
        }
        /* æ¨¡å—å®¹å™¨ */
        .module {
            display: none;
            width: 90%;
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0,0,0,0.08);
            padding: 25px;
            margin-bottom: 20px;
        }
        .module.active {
            display: block;
            -webkit-animation: fadeIn3d 0.8s ease;
            animation: fadeIn3d 0.8s ease;
        }
        @-webkit-keyframes fadeIn3d {
            0% {
                -webkit-transform: perspective(800px) rotateY(30deg);
                transform: perspective(800px) rotateY(30deg);
                opacity: 0;
            }
            100% {
                -webkit-transform: perspective(800px) rotateY(0);
                transform: perspective(800px) rotateY(0);
                opacity: 1;
            }
        }
        @keyframes fadeIn3d {
            0% {
                -webkit-transform: perspective(800px) rotateY(30deg);
                transform: perspective(800px) rotateY(30deg);
                opacity: 0;
            }
            100% {
                -webkit-transform: perspective(800px) rotateY(0);
                transform: perspective(800px) rotateY(0);
                opacity: 1;
            }
        }
        /* é˜¶æ®µä¸€ï¼šå®åè®¤è¯ */
        .auth-form {
            display: flex;
            flex-direction: column;
            gap: 15px;
            max-width: 500px;
            margin: 0 auto;
        }
        .auth-form input {
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
        }
        .auth-form button {
            background: #2ecc71;
            color: white;
            border: none;
            padding: 12px;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
        }
        .data-analysis {
            margin-top: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 5px;
        }
        .data-analysis h4 {
            margin-bottom: 10px;
            color: #2c3e50;
        }
        .tips {
            color: #e74c3c;
            text-align: center;
            margin: 10px 0;
            font-size: 14px;
        }
        /* é˜¶æ®µäºŒï¼šè½¦ç¥¨è®¤è¯ */
        .ticket-filter {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        .filter-btn {
            padding: 8px 15px;
            border: 1px solid #3498db;
            background: white;
            color: #3498db;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
        }
        .filter-btn.active {
            background: #3498db;
            color: white;
        }
        .ticket-confirm {
            margin: 20px 0;
            text-align: center;
        }
        .ticket-confirm-btn {
            background: #2ecc71;
            color: white;
            border: none;
            padding: 10px 30px;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
        }
        .ticket-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 15px;
        }
        .ticket-card {
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            transform: perspective(600px) rotateX(5deg);
            transition: transform 0.3s;
        }
        .ticket-card:hover {
            transform: perspective(600px) rotateX(0);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        /* é˜¶æ®µä¸‰ï¼šæ ¸å¿ƒ - äº¤äº’åœ°å›¾ */
        .game-container {
            display: flex;
            gap: 20px;
            height: 850px; /* è°ƒæ•´å®¹å™¨é«˜åº¦ï¼Œç¡®ä¿åœ°å›¾å’Œé¢æ¿éƒ½èƒ½å®Œæ•´æ˜¾ç¤º */
        }
        /* 3Däº¤äº’åœ°å›¾åŒºåŸŸ */
        .map-area {
            flex: 2;
            border: 1px solid #ddd;
            border-radius: 8px;
            position: relative;
            background: url('https://img0.baidu.com/it/u=1823266692,3842132192&fm=253&fmt=auto&app=138&f=JPEG?w=1200&h=900') center/cover no-repeat;
            perspective: 1500px;
            height: 800px; /* å›ºå®šé«˜åº¦ï¼Œç¡®ä¿æ‰€æœ‰å…ƒç´ å…¥æ¡† */
            width: 100%;   /* å›ºå®šå®½åº¦ */
            overflow: hidden; /* å¼ºåˆ¶è£å‰ªæº¢å‡ºå†…å®¹ */
        }
        /* è·¯çº¿è§„åˆ’æç¤º */
        .route-tips {
            position: absolute;
            top: 10px;
            left: 10px;
            background: rgba(255,255,255,0.9);
            padding: 8px 15px;
            border-radius: 5px;
            font-size: 14px;
            z-index: 10;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        /* åœ°å›¾èŠ‚ç‚¹æ ·å¼ */
        .map-node {
            position: absolute;
            transform-style: preserve-3d;
            transform: translateZ(20px);
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            z-index: 5;
            /* æ ¸å¿ƒä¿®æ”¹ï¼šå‡å°æ•´ä½“å†…è¾¹è·ï¼Œç¼©å°ç™½è‰²æ–¹æ¡† */
            background: rgba(255,255,255,0.9);
            padding: 2px 4px; /* åŸï¼š5px 8px */
            border-radius: 5px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1); /* å¾®è°ƒé˜´å½±ï¼Œæ›´è´´åˆå°æ–¹æ¡† */
        }

        .map-node:hover {
            transform: translateZ(30px) scale(1.1);
        }
        .node-start { /* èµ·ç‚¹ï¼šç¯çƒæ¸¯ */
            top: 50px;
            left: 50px;
            color: #e74c3c;
        }
        .node-end { /* ç»ˆç‚¹ï¼šä½˜å±± */
            top: 50px;
            left: 50px;
            color: #e74c3c;
        }
        .node-scenic { /* æ™¯ç‚¹ */
            color: #2ecc71;
        }
        .node-toilet { /* å•æ‰€ */
            color: #9b59b6;
        }
        .node-rest { /* ä¼‘æ¯ç«™ */
            color: #3498db;
        }
        .map-node .icon {
            font-size: 24px; /* åŸï¼š30pxï¼Œå‡å°å›¾æ ‡å¤§å° */
            margin-bottom: 3px; /* åŸï¼š5pxï¼Œå‡å°å›¾æ ‡å’Œæ–‡å­—é—´è· */
            text-shadow: 0 1px 2px rgba(0,0,0,0.2);
        }
        .map-node .name {
            font-size: 12px; /* åŸï¼š14pxï¼Œå‡å°æ–‡å­—å¤§å° */
            white-space: nowrap;
            background: rgba(255,255,255,0.8);
            padding: 2px 5px; /* åŸï¼š3px 8pxï¼Œå‡å°æ–‡å­—èƒŒæ™¯å†…è¾¹è· */
            border-radius: 3px;
            box-shadow: 0 1px 2px rgba(0,0,0,0.1);
        }
        /* è§„åˆ’çš„è·¯çº¿è½¨è¿¹ */
        .route-path {
            position: absolute;
            background: linear-gradient(to right, #e74c3c, #f39c12);
            height: 4px;
            transform: translateZ(10px);
            z-index: 4;
            /* é»˜è®¤éšè—ï¼Œè§„åˆ’åæ˜¾ç¤º */
            display: none;
            border-radius: 2px;
            box-shadow: 0 2px 4px rgba(231, 76, 60, 0.3);
            /* è·¯çº¿åŠ¨ç”» */
            animation: routeDraw 2s ease forwards;
            width: 0;
        }
        @keyframes routeDraw {
            0% { width: 0; }
            100% { width: 100%; }
        }
        /* è·¯çº¿èŠ‚ç‚¹é«˜äº®æ ·å¼ */
        .map-node.highlight {
            transform: translateZ(40px) scale(1.2);
            animation: nodePulse 1.5s infinite;
        }
        @keyframes nodePulse {
            0% { opacity: 1; }
            50% { opacity: 0.7; }
            100% { opacity: 1; }
        }
        /* å³ä¾§é¢æ¿ï¼šåœ¨çº¿ç”¨æˆ·+äº’åŠ¨+åˆ†ç±» */
        .side-panel {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        /* è·¯çº¿/ç›®çš„åœ°åˆ†ç±»ç­›é€‰ */
        .route-filter {
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
        }
        .route-filter h3 {
            margin-bottom: 10px;
            color: #2c3e50;
            font-size: 16px;
        }
        .route-filter-btn {
            padding: 6px 12px;
            border: 1px solid #3498db;
            background: white;
            color: #3498db;
            border-radius: 4px;
            cursor: pointer;
            margin: 0 5px 5px 0;
            font-size: 14px;
        }
        .route-filter-btn.active {
            background: #3498db;
            color: white;
        }
        /* å®æ—¶åœ¨çº¿ç”¨æˆ·åˆ—è¡¨ */
        .online-users {
            flex: 1;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            overflow-y: auto;
        }
        .online-users h3 {
            margin-bottom: 10px;
            color: #2c3e50;
        }
        .user-item {
            padding: 10px;
            border-bottom: 1px solid #eee;
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
            border-radius: 5px;
            margin-bottom: 5px;
        }
        .user-item:hover {
            background: #f8f9fa;
        }
        .user-item.same-route {
            border-left: 3px solid #2ecc71;
            background: rgba(46, 204, 113, 0.05);
        }
        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #3498db;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
        }
        .user-route {
            font-size: 12px;
            color: #666;
        }
        .user-tag {
            font-size: 12px;
            padding: 2px 6px;
            border-radius: 3px;
            background: #2ecc71;
            color: white;
            margin-left: auto;
        }
        /* è§’è‰²äº’åŠ¨èŠå¤©åŒº */
        .chat-area {
            flex: 1;
            border: 1px solid #ddd;
            border-radius: 8px;
            display: flex;
            flex-direction: column;
        }
        .chat-messages {
            flex: 1;
            padding: 10px;
            overflow-y: auto;
        }
        .chat-msg {
            margin-bottom: 10px;
            padding: 8px;
            border-radius: 5px;
            max-width: 80%;
        }
        .msg-self {
            background: #3498db;
            color: white;
            margin-left: auto;
        }
        .msg-other {
            background: #eee;
            color: #333;
        }
        .chat-input {
            display: flex;
            gap: 5px;
            padding: 10px;
            border-top: 1px solid #ddd;
        }
        .chat-input input {
            flex: 1;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .chat-input button {
            padding: 8px 15px;
            background: #2ecc71;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        /* æ™¯ç‚¹ä»‹ç»å¼¹çª— */
        .scenic-modal {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) perspective(800px) rotateY(0);
            width: 600px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 0 30px rgba(0,0,0,0.2);
            padding: 20px;
            z-index: 100;
            animation: modal3d 0.5s ease;
        }
        @keyframes modal3d {
            0% { transform: translate(-50%, -50%) perspective(800px) rotateY(30deg) scale(0.8); opacity: 0; }
            100% { transform: translate(-50%, -50%) perspective(800px) rotateY(0) scale(1); opacity: 1; }
        }
        .modal-close {
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 20px;
            cursor: pointer;
            color: #999;
        }
        .modal-close:hover {
            color: #e74c3c;
        }
        .scenic-img {
            width: 100%;
            height: 250px;
            object-fit: cover;
            border-radius: 8px;
            margin-bottom: 15px;
        }
        .scenic-route-tips {
            margin-top: 10px;
            padding: 8px;
            background: rgba(46, 204, 113, 0.1);
            border-radius: 5px;
            font-size: 14px;
            color: #27ae60;
        }
        /* ========== ç§»åŠ¨ç«¯é€‚é…æ ¸å¿ƒæ ·å¼ï¼ˆ768pxä»¥ä¸‹æ‰‹æœºå±å¹•ï¼‰ ========== */
@media (max-width: 768px) {
    /* å…¨å±€è°ƒæ•´ï¼šå–æ¶ˆæ¨ªå‘æ»šåŠ¨ï¼Œé€‚é…å±å¹•å®½åº¦ */
    body {
        padding-bottom: 10px;
        overflow-x: hidden;
    }

    /* æµç¨‹å®¹å™¨ï¼šé€‚é…æ‰‹æœºå®½åº¦ */
    .process-container {
        width: 98%;
        margin: 10px auto;
        gap: 10px;
    }

    /* æ­¥éª¤æ¡ï¼šç¼©å°èŠ‚ç‚¹å°ºå¯¸ï¼Œè°ƒæ•´æ–‡å­— */
    .step-bar {
        padding: 0 10px;
    }
    .step-item {
        width: 30px;
        height: 30px;
        font-size: 12px;
    }
    .step-item .step-name {
        font-size: 12px;
        top: 40px;
    }

    /* å¯¼èˆªæ ï¼šå‚ç›´æ’åˆ—ï¼Œé€‚é…æ‰‹æœº */
    .nav {
        flex-direction: column;
        padding: 10px;
        gap: 8px;
    }
    .nav-btn {
        width: 100%;
        margin: 0;
        padding: 12px;
        font-size: 14px;
    }

    /* æ¨¡å—å®¹å™¨ï¼šé€‚é…æ‰‹æœºå®½åº¦ï¼Œå‡å°‘å†…è¾¹è· */
    .module {
        width: 98%;
        padding: 15px;
        margin-bottom: 10px;
    }

    /* æ¸¸æˆå®¹å™¨ï¼šä»å·¦å³å¸ƒå±€æ”¹ä¸ºä¸Šä¸‹å¸ƒå±€ï¼ˆæ ¸å¿ƒé€‚é…ï¼‰ */
    .game-container {
        flex-direction: column;
        height: auto !important; /* å–æ¶ˆå›ºå®šé«˜åº¦ï¼Œè‡ªé€‚åº” */
        gap: 15px;
    }

    /* åœ°å›¾åŒºåŸŸï¼šé€‚é…æ‰‹æœºé«˜åº¦ï¼Œå–æ¶ˆå›ºå®šå°ºå¯¸ */
    .map-area {
        flex: none;
        height: 500px !important; /* æ‰‹æœºç«¯é€‚é…é«˜åº¦ */
        width: 100%;
        overflow: auto; /* å…è®¸ç§»åŠ¨ç«¯æ»šåŠ¨æŸ¥çœ‹å®Œæ•´åœ°å›¾ */
    }

    /* åœ°å›¾èŠ‚ç‚¹ï¼šç¼©å°å°ºå¯¸ï¼Œé€‚é…æ‰‹æœºå±å¹• */
    .map-node {
        padding: 1px 3px;
        transform: translateZ(10px);
    }
    .map-node .icon {
        font-size: 20px;
        margin-bottom: 2px;
    }
    .map-node .name {
        font-size: 11px;
        padding: 1px 3px;
    }
    /* è°ƒæ•´èŠ‚ç‚¹åæ ‡ï¼Œé¿å…æ‰‹æœºç«¯é”™ä½ */
    .map-node.node-start { top: 30px; left: 20px; }
    .map-node.node-end { top: 450px; left: 250px; }
    .map-node.node-shop { top: 80px; left: 80px; }
    .map-node.node-scenic { top: 150px; left: 50px; }
    .map-node.node-toilet { top: 220px; left: 150px; }
    .map-node.node-rest { top: 300px; left: 200px; }

    /* å³ä¾§é¢æ¿ï¼šé€‚é…æ‰‹æœºå®½åº¦ï¼Œflexå æ»¡ */
    .side-panel {
        flex: none;
        width: 100%;
        gap: 10px;
    }
    /* è·¯çº¿ç­›é€‰æŒ‰é’®ï¼šé€‚é…æ‰‹æœº */
    .route-filter-btn {
        padding: 5px 10px;
        font-size: 12px;
    }
    /* åœ¨çº¿ç”¨æˆ·/èŠå¤©åŒºï¼šé€‚é…æ‰‹æœºé«˜åº¦ */
    .online-users {
        max-height: 200px;
    }
    .chat-area {
        max-height: 250px;
    }

    /* æ™¯ç‚¹å¼¹çª—ï¼šé€‚é…æ‰‹æœºå±å¹•ï¼ˆæ ¸å¿ƒï¼‰ */
    .scenic-modal {
        width: 90% !important; /* å å±å¹•90%å®½åº¦ */
        padding: 15px;
    }
    .scenic-img {
        height: 180px !important; /* æ‰‹æœºç«¯å›¾ç‰‡é«˜åº¦ */
    }

    /* è¡¨å•å…ƒç´ ï¼šæ”¾å¤§è¾“å…¥æ¡†/æŒ‰é’®ï¼Œé€‚é…æ‰‹æœºç‚¹å‡» */
    .auth-form input, .auth-form button {
        padding: 14px;
        font-size: 16px;
    }
    .ticket-confirm-btn {
        padding: 12px 20px;
        font-size: 16px;
    }
    .chat-input input {
        padding: 10px;
        font-size: 16px;
    }
    .chat-input button {
        padding: 10px 15px;
    }

    /* è½¦ç¥¨å¡ç‰‡ï¼šæ‰‹æœºç«¯å•åˆ—æ˜¾ç¤º */
    .ticket-list {
        grid-template-columns: 1fr; /* å–æ¶ˆå¤šåˆ—ï¼Œå•åˆ— */
    }
}

/* æ›´å°å±å¹•ï¼ˆ480pxä»¥ä¸‹ï¼Œå¦‚å°å±æ‰‹æœºï¼‰é¢å¤–ä¼˜åŒ– */
@media (max-width: 480px) {
    .map-area {
        height: 400px !important;
    }
    .scenic-img {
        height: 150px !important;
    }
    .step-item .step-name {
        font-size: 10px;
    }
}
    </style>
</head>
<body>
<!-- æµç¨‹å®¹å™¨ -->
<div class="process-container">
    <!-- æ­¥éª¤æ¡ -->
    <div class="step-bar step-1" id="stepBar">
        <div class="step-item active" id="step1">
            1
            <div class="step-name">å®åè®¤è¯</div>
        </div>
        <div class="step-item" id="step2">
            2
            <div class="step-name">è½¦ç¥¨è®¤è¯</div>
        </div>
        <div class="step-item" id="step3">
            3
            <div class="step-name">æ¸¸æˆäº’åŠ¨</div>
        </div>
    </div>

    <!-- å¯¼èˆªæ  -->
    <div class="nav">
        <button class="nav-btn active" id="nav1" data-target="auth-module">é˜¶æ®µä¸€ï¼šå®åè®¤è¯</button>
        <button class="nav-btn disabled" id="nav2" data-target="ticket-module">é˜¶æ®µäºŒï¼šè½¦ç¥¨è®¤è¯</button>
        <button class="nav-btn disabled" id="nav3" data-target="game-module">é˜¶æ®µä¸‰ï¼šæ¸¸æˆäº’åŠ¨</button>
    </div>
</div>

<!-- é˜¶æ®µä¸€ï¼šå®åè®¤è¯æ¨¡å— -->
<div class="module active" id="auth-module">
    <h2 style="text-align: center; margin-bottom: 20px; color: #2c3e50;">é˜¶æ®µä¸€ï¼šå®åè®¤è¯ï¼ˆæ¨¡æ‹Ÿï¼‰</h2>
    <p class="tips">è¯·å®Œæˆå®åè®¤è¯ï¼Œæäº¤åè§£é”è½¦ç¥¨è®¤è¯ç¯èŠ‚</p>
    <div class="auth-form">
        <input type="text" id="realName" placeholder="è¯·è¾“å…¥çœŸå®å§“å">
        <input type="text" id="idCard" placeholder="è¯·è¾“å…¥èº«ä»½è¯å·ï¼ˆæ¨¡æ‹Ÿï¼š18ä½æ•°å­—ï¼‰">
        <input type="text" id="phone" placeholder="è¯·è¾“å…¥æ‰‹æœºå·ï¼ˆæ¨¡æ‹Ÿï¼š11ä½æ•°å­—ï¼‰">
        <button onclick="submitAuth()">æäº¤å®åè®¤è¯</button>
    </div>
    <div class="data-analysis">
        <h4>æ•°æ®æŠ“å–&éœ€æ±‚åˆ†æ&åŒç­‰åˆ†æï¼ˆæ¨¡æ‹Ÿï¼‰</h4>
        <p>âœ… å®åè®¤è¯æ•°æ®æŠ“å–ï¼šå§“å/èº«ä»½è¯/æ‰‹æœºå·å·²åŠ å¯†å­˜å‚¨ï¼Œä»…å±•ç¤ºè„±æ•åæ•°æ®</p>
        <p>âœ… éœ€æ±‚åˆ†æï¼šç”¨æˆ·æ ¸å¿ƒéœ€æ±‚ä¸ºã€Œç¯çƒæ¸¯â†’ä½˜å±±ã€ä¾¿æ·å‡ºè¡Œ+æ™¯ç‚¹ä½“éªŒ+äº’åŠ¨ç¤¾äº¤</p>
        <p>âœ… åŒç­‰åˆ†æï¼šå¯¹æ¯”åŒç±»æ—…æ¸¸å°æ¸¸æˆï¼Œæ–°å¢ã€Œå®æ—¶è·¯çº¿è§„åˆ’+å•æ‰€/ä¼‘æ¯ç«™åˆ†å¸ƒã€å·®å¼‚åŒ–åŠŸèƒ½</p>
    </div>
</div>

<!-- é˜¶æ®µäºŒï¼šè½¦ç¥¨è®¤è¯æ¨¡å— -->
<div class="module" id="ticket-module">
    <h2 style="text-align: center; margin-bottom: 20px; color: #2c3e50;">é˜¶æ®µäºŒï¼šè½¦ç¥¨è®¤è¯ï¼ˆæ¨¡æ‹Ÿï¼‰</h2>
    <p class="tips">è¯·é€‰æ‹©è½¦ç¥¨åˆ†ç±»ï¼Œç¡®è®¤åè§£é”æ¸¸æˆäº’åŠ¨ç¯èŠ‚</p>
    <div class="ticket-filter">
        <button class="filter-btn active" data-type="all">å…¨éƒ¨è½¦ç¥¨</button>
        <button class="filter-btn" data-type="route">åŒç¨‹åˆ†ç±»</button>
        <button class="filter-btn" data-type="age">å¹´é¾„åˆ†ç±»</button>
        <button class="filter-btn" data-type="dest">ç›®çš„åœ°åˆ†ç±»</button>
        <button class="filter-btn" data-type="purpose">ç›®çš„åˆ†ç±»</button>
    </div>
    <div class="ticket-confirm">
        <button class="ticket-confirm-btn" onclick="confirmTicketFilter()">ç¡®è®¤è½¦ç¥¨åˆ†ç±»</button>
    </div>
    <div class="ticket-list" id="ticketList">
        <!-- è½¦ç¥¨å¡ç‰‡ç”±JSåŠ¨æ€ç”Ÿæˆ -->
    </div>
</div>

<!-- é˜¶æ®µä¸‰ï¼šæ¸¸æˆäº’åŠ¨æ¨¡å—ï¼ˆå®Œæ•´ä¿®å¤ç‰ˆï¼‰ -->
<div class="module" id="game-module">
    <h2 style="text-align: center; margin-bottom: 20px; color: #2c3e50;">é˜¶æ®µä¸‰ï¼šç¯çƒæ¸¯â†’ä½˜å±± å®šå‘æ—…æ¸¸å°æ¸¸æˆï¼ˆå®Œæ•´åœ°å›¾ç‰ˆï¼‰</h2>
    <div class="game-container">
        <!-- 3Däº¤äº’åœ°å›¾åŒºåŸŸï¼ˆè§£å†³æ‰€æœ‰é—®é¢˜ï¼‰ -->
        <div class="map-area" id="mapArea">
            <div class="route-tips">ğŸ’¡ ç‚¹å‡»ã€ç»ˆç‚¹ï¼šä½˜å±±ã€‘è‡ªåŠ¨è§„åˆ’æœ€ä¼˜è·¯çº¿</div>
            <!-- SVGè·¯çº¿å®¹å™¨ -->
            <svg id="routeSvg" width="100%" height="100%" style="position: absolute; top: 0; left: 0; z-index: 3;">
                <path id="routePath" d="" fill="none" stroke="url(#routeGradient)" stroke-width="4" stroke-linecap="round" stroke-dasharray="1500" stroke-dashoffset="1500" opacity="0">
                    <animate id="routeAnimation" attributeName="stroke-dashoffset" from="1500" to="0" dur="3s" fill="freeze" begin="indefinite" />
                </path>
                <defs>
                    <linearGradient id="routeGradient" x1="0%" y1="0%" x2="100%" y2="0%">
                        <stop offset="0%" style="stop-color:#e74c3c" />
                        <stop offset="100%" style="stop-color:#f39c12" />
                    </linearGradient>
                </defs>
            </svg>
            <!-- åœ°å›¾èŠ‚ç‚¹ï¼ˆå…¨éƒ¨åœ¨å®¹å™¨å†…ï¼Œé‡æ–°ç¼–æ’åæ ‡ï¼‰ -->
            <div class="map-node node-start" style="top: 50px; left: 50px;">
                <div class="icon">ğŸ“</div>
                <div class="name">èµ·ç‚¹ï¼šç¯çƒæ¸¯</div>
            </div>
            <div class="map-node node-shop" style="top: 100px; left: 120px;">
                <div class="icon">ğŸŸ</div>
                <div class="name">è‚¯å¾·åŸºï¼ˆç¯çƒæ¸¯åº—ï¼‰</div>
            </div>
            <div class="map-node node-scenic" style="top: 180px; left: 80px;" onclick="showScenicModal('é•¿é£å…¬å›­')">
                <div class="icon">ğŸï¸</div>
                <div class="name">é•¿é£å…¬å›­</div>
            </div>
            <div class="map-node node-toilet" style="top: 250px; left: 200px;">
                <div class="icon">ğŸš»</div>
                <div class="name">å…¬å…±å•æ‰€ï¼ˆæ™®é™€ï¼‰</div>
            </div>
            <div class="map-node node-rest" style="top: 350px; left: 250px;">
                <div class="icon">ğŸ›‹ï¸</div>
                <div class="name">ä¼‘æ¯ç«™ï¼ˆæ™®é™€æ®µï¼‰</div>
            </div>
            <div class="map-node node-shop" style="top: 300px; left: 300px;">
                <div class="icon">ğŸ”</div>
                <div class="name">éº¦å½“åŠ³ï¼ˆè™¹æ¡¥åº—ï¼‰</div>
            </div>
            <div class="map-node node-scenic" style="top: 450px; left: 400px;" onclick="showScenicModal('è™¹æ¡¥å¤©åœ°')">
                <div class="icon">ğŸ™ï¸</div>
                <div class="name">è™¹æ¡¥å¤©åœ°</div>
            </div>
            <div class="map-node node-rest" style="top: 550px; left: 500px;">
                <div class="icon">ğŸ›‹ï¸</div>
                <div class="name">ä¼‘æ¯ç«™ï¼ˆæ¾æ±Ÿæ®µï¼‰</div>
            </div>
            <div class="map-node node-scenic" style="top: 500px; left: 550px;" onclick="showScenicModal('ä¸Šæµ·è¾°å±±æ¤ç‰©å›­')">
                <div class="icon">ğŸŒ¿</div>
                <div class="name">è¾°å±±æ¤ç‰©å›­</div>
            </div>
            <div class="map-node node-toilet" style="top: 650px; left: 500px;">
                <div class="icon">ğŸš»</div>
                <div class="name">å…¬å…±å•æ‰€ï¼ˆæ¾æ±Ÿï¼‰</div>
            </div>
            <div class="map-node node-shop" style="top: 600px; left: 550px;">
                <div class="icon">â˜•</div>
                <div class="name">æ˜Ÿå·´å…‹ï¼ˆä½˜å±±åº—ï¼‰</div>
            </div>
            <!-- ç»ˆç‚¹ï¼ˆå®¹å™¨å†…å³ä¸‹è§’ï¼Œå®Œå…¨å¯è§ï¼‰ -->
            <div class="map-node node-end" id="nodeEnd" style="top: 650px; left: 600px;" onclick="planRoute()">
                <div class="icon">ğŸ</div>
                <div class="name">ç»ˆç‚¹ï¼šä½˜å±±</div>
            </div>
        </div>

        <!-- å³ä¾§é¢æ¿ï¼šä¿æŒä¸å˜ -->
        <div class="side-panel">
            <div class="route-filter">
                <h3>è·¯çº¿/ç›®çš„åœ°è‡ªåŠ¨åˆ†ç±»</h3>
                <button class="route-filter-btn active" data-filter="all">å…¨éƒ¨ç”¨æˆ·</button>
                <button class="route-filter-btn" data-filter="sameRoute">åŒè·¯çº¿ï¼ˆç¯çƒæ¸¯â†’ä½˜å±±ï¼‰</button>
                <button class="route-filter-btn" data-filter="sameDest">åŒç›®çš„åœ°ï¼ˆä½˜å±±ï¼‰</button>
            </div>
            <div class="online-users" id="onlineUserList">
                <h3>å®æ—¶å…±äº«åŒé¢‘åœ¨çº¿ç”¨æˆ·</h3>
            </div>
            <div class="chat-area">
                <h3 style="padding: 10px; border-bottom: 1px solid #ddd; color: #2c3e50;">è§’è‰²äº’åŠ¨äº¤æµ</h3>
                <div class="chat-messages" id="chatMessages"></div>
                <div class="chat-input">
                    <input type="text" id="chatInput" placeholder="è¾“å…¥æ¶ˆæ¯å’Œåœ¨çº¿ç”¨æˆ·äº’åŠ¨...">
                    <button onclick="sendChat()">å‘é€</button>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- æ™¯ç‚¹ä»‹ç»å¼¹çª— -->
<div class="scenic-modal" id="scenicModal">
    <span class="modal-close" onclick="closeScenicModal()">Ã—</span>
    <h3 id="scenicName" style="margin-bottom: 15px; color: #2c3e50;"></h3>
    <img src="" id="scenicImg" class="scenic-img">
    <p id="scenicDesc"></p>
    <div class="scenic-route-tips" id="scenicRouteTips"></div>
</div>

<script>
    // ========== å…¨å±€çŠ¶æ€ ==========
    let stepStatus = {
        step1Done: false,
        step2Done: false
    };
    // å½“å‰è§„åˆ’çš„è·¯çº¿èŠ‚ç‚¹
    let plannedRouteNodes = [];
    // åœ¨çº¿ç”¨æˆ·æ•°æ®ï¼ˆå«è·¯çº¿/ç›®çš„åœ°ä¿¡æ¯ï¼‰
    const userData = [
        { id: 1, name: 'æ¸¸å®¢1', avatar: 'æ¸¸', route: 'ç¯çƒæ¸¯â†’ä½˜å±±', dest: 'ä½˜å±±', purpose: 'æ—…æ¸¸è§‚å…‰' },
        { id: 2, name: 'æ¸¸å®¢2', avatar: 'å®¢', route: 'ç¯çƒæ¸¯â†’ä½˜å±±', dest: 'ä½˜å±±', purpose: 'äº²å­æ¸¸ç©' },
        { id: 3, name: 'æ¸¸å®¢3', avatar: 'å°', route: 'äººæ°‘å¹¿åœºâ†’ä½˜å±±', dest: 'ä½˜å±±', purpose: 'ä¼‘é—²' },
        { id: 4, name: 'æ¸¸å®¢4', avatar: 'æ˜', route: 'ç¯çƒæ¸¯â†’è¾°å±±æ¤ç‰©å›­', dest: 'è¾°å±±æ¤ç‰©å›­', purpose: 'æ‹ç…§' },
        { id: 5, name: 'æ¸¸å®¢5', avatar: 'ä¸½', route: 'ç¯çƒæ¸¯â†’ä½˜å±±', dest: 'ä½˜å±±', purpose: 'ç™»å±±' },
        { id: 6, name: 'æ¸¸å®¢6', avatar: 'å¼º', route: 'è™¹æ¡¥â†’è¾°å±±æ¤ç‰©å›­', dest: 'è¾°å±±æ¤ç‰©å›­', purpose: 'ç§‘æ™®' },
    ];
    // èŠå¤©æ¶ˆæ¯æ•°æ®
    const chatData = [
        { sender: 'æ¸¸å®¢1', content: 'æœ‰æ²¡æœ‰ä¸€èµ·èµ°ç¯çƒæ¸¯â†’ä½˜å±±è·¯çº¿çš„ï¼Ÿ', isSelf: false },
        { sender: 'æ¸¸å®¢2', content: 'æˆ‘åˆšåˆ°æ™®é™€æ®µä¼‘æ¯ç«™ï¼Œæœ‰æ²¡æœ‰äººä¸€èµ·ï¼Ÿ', isSelf: false },
    ];
    // æ™¯ç‚¹æ•°æ®ï¼ˆå…³è”è·¯çº¿ï¼‰
    const scenicData = {
        'é•¿é£å…¬å›­': {
            img: './changfeng.jpg',
            desc: 'é•¿é£å…¬å›­ä½äºæ™®é™€åŒºï¼Œæ˜¯ä¸Šæµ·è€ç‰Œçš„åŸå¸‚å…¬å›­ï¼Œæ‹¥æœ‰å¤§ç‰‡æ¹–é¢å’Œç»¿æ¤ï¼Œæ˜¯ç¯çƒæ¸¯â†’ä½˜å±±è·¯çº¿ä¸Šçš„é¦–ä¸ªé€”ç»æ™¯ç‚¹ï¼Œé€‚åˆçŸ­æš‚ä¼‘æ†©ã€‚',
            routeTips: 'âœ… è¯¥æ™¯ç‚¹åœ¨ã€ç¯çƒæ¸¯â†’ä½˜å±±ã€‘è§„åˆ’è·¯çº¿ä¸Šï¼Œè·ç¦»èµ·ç‚¹çº¦5km'
        },
        'è™¹æ¡¥å¤©åœ°': {
            img: './hongqiao.jpg',
            desc: 'è™¹æ¡¥å¤©åœ°ä½äºè™¹æ¡¥å•†åŠ¡åŒºï¼Œæ˜¯é›†è´­ç‰©ã€é¤é¥®ã€ä¼‘é—²äºä¸€ä½“çš„å•†ä¸šç»¼åˆä½“ï¼Œæ˜¯ç¯çƒæ¸¯â†’ä½˜å±±è·¯çº¿çš„ä¸­é—´èŠ‚ç‚¹ï¼Œé€‚åˆè¡¥å……ç‰©èµ„ã€‚',
            routeTips: 'âœ… è¯¥æ™¯ç‚¹åœ¨ã€ç¯çƒæ¸¯â†’ä½˜å±±ã€‘è§„åˆ’è·¯çº¿ä¸Šï¼Œè·ç¦»èµ·ç‚¹çº¦15km'
        },
        'ä¸Šæµ·è¾°å±±æ¤ç‰©å›­': {
            img: './chenshan.webp',
            desc: 'ä¸Šæµ·è¾°å±±æ¤ç‰©å›­ä½äºä½˜å±±é™„è¿‘ï¼Œæ˜¯åä¸œåœ°åŒºè§„æ¨¡æœ€å¤§çš„æ¤ç‰©å›­ä¹‹ä¸€ï¼Œæ‹¥æœ‰çƒ­å¸¦èŠ±æœé¦†ã€æ²™ç”Ÿæ¤ç‰©é¦†ç­‰ç‰¹è‰²åœºé¦†ã€‚',
            routeTips: 'âœ… è¯¥æ™¯ç‚¹åœ¨ã€ç¯çƒæ¸¯â†’ä½˜å±±ã€‘è§„åˆ’è·¯çº¿ä¸Šï¼Œè·ç¦»ç»ˆç‚¹çº¦3km'
        }
    };
    // è½¦ç¥¨æ•°æ®
    const ticketData = [
        { id: 1, route: 'ç¯çƒæ¸¯â†’ä½˜å±±ï¼ˆåœ°é“11å·çº¿ï¼‰', age: '20-30å²', dest: 'ä½˜å±±å›½å®¶æ£®æ—å…¬å›­', purpose: 'æ—…æ¸¸è§‚å…‰', name: 'å¼ ä¸‰' },
        { id: 2, route: 'ç¯çƒæ¸¯â†’ä½˜å±±ï¼ˆè‡ªé©¾ï¼‰', age: '30-40å²', dest: 'è¾°å±±æ¤ç‰©å›­', purpose: 'äº²å­æ¸¸ç©', name: 'æå››' },
        { id: 3, route: 'ç¯çƒæ¸¯â†’ä½˜å±±ï¼ˆå…¬äº¤ï¼‰', age: '40-50å²', dest: 'ä½˜å±±', purpose: 'ä¼‘é—²æ•£æ­¥', name: 'ç‹äº”' },
        { id: 4, route: 'äººæ°‘å¹¿åœºâ†’ä½˜å±±', age: '20-30å²', dest: 'ä½˜å±±å›½å®¶æ£®æ—å…¬å›­', purpose: 'æ—…æ¸¸è§‚å…‰', name: 'èµµå…­' },
        { id: 5, route: 'ç¯çƒæ¸¯â†’ä½˜å±±ï¼ˆåœ°é“11å·çº¿ï¼‰', age: '50+å²', dest: 'ä½˜å±±', purpose: 'å…»è€ä¼‘é—²', name: 'å­™ä¸ƒ' },
    ];

    // ========== æ­¥éª¤åˆ‡æ¢é€»è¾‘ ==========
    const navBtns = document.querySelectorAll('.nav-btn');
    const modules = document.querySelectorAll('.module');
    const stepBar = document.getElementById('stepBar');
    const stepItems = document.querySelectorAll('.step-item');

    navBtns.forEach(btn => {
        btn.addEventListener('click', () => {
            if (btn.classList.contains('disabled')) {
                alert('è¯·å…ˆå®Œæˆä¸Šä¸€é˜¶æ®µçš„æ“ä½œï¼');
                return;
            }
            navBtns.forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            const target = btn.getAttribute('data-target');
            modules.forEach(module => {
                module.classList.remove('active');
                if (module.id === target) {
                    module.classList.add('active');
                }
            });
            const stepNum = btn.id.replace('nav', '');
            stepItems.forEach((item, index) => {
                item.classList.remove('active');
                if (index + 1 === parseInt(stepNum)) {
                    item.classList.add('active');
                }
            });
            if (target === 'ticket-module') initTicketList();
            if (target === 'game-module') initGameData();
        });
    });

    // ========== é˜¶æ®µä¸€ï¼šå®åè®¤è¯ ==========
    function submitAuth() {
        const realName = document.getElementById('realName').value;
        const idCard = document.getElementById('idCard').value;
        const phone = document.getElementById('phone').value;
        if (!realName || !idCard || !phone) {
            alert('è¯·å¡«å†™å®Œæ•´å®åè®¤è¯ä¿¡æ¯ï¼');
            return;
        }
        alert(`å®åè®¤è¯æˆåŠŸï¼\nè„±æ•åæ•°æ®ï¼š\nå§“åï¼š${realName.substring(0,1)}*\nèº«ä»½è¯ï¼š${idCard.substring(0,6)}********${idCard.substring(14)}\næ‰‹æœºå·ï¼š${phone.substring(0,3)}****${phone.substring(7)}`);
        stepStatus.step1Done = true;
        stepBar.className = 'step-bar step-2';
        stepItems[0].classList.remove('active');
        stepItems[0].classList.add('done');
        stepItems[1].classList.add('active');
        document.getElementById('nav2').classList.remove('disabled');
        document.getElementById('nav2').click();
    }

    // ========== é˜¶æ®µäºŒï¼šè½¦ç¥¨è®¤è¯ ==========
    function initTicketList() {
        const ticketList = document.getElementById('ticketList');
        ticketList.innerHTML = '';
        renderTickets(ticketData);
        const filterBtns = document.querySelectorAll('.filter-btn');
        filterBtns.forEach(btn => {
            btn.addEventListener('click', () => {
                filterBtns.forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                const type = btn.getAttribute('data-type');
                let filteredTickets = ticketData;
                switch (type) {
                    case 'route': filteredTickets = ticketData.filter(t => t.route.includes('ç¯çƒæ¸¯â†’ä½˜å±±')); break;
                    case 'age': filteredTickets = ticketData.filter(t => t.age === '20-30å²'); break;
                    case 'dest': filteredTickets = ticketData.filter(t => t.dest === 'ä½˜å±±å›½å®¶æ£®æ—å…¬å›­'); break;
                    case 'purpose': filteredTickets = ticketData.filter(t => t.purpose === 'æ—…æ¸¸è§‚å…‰'); break;
                    default: filteredTickets = ticketData;
                }
                renderTickets(filteredTickets);
            });
        });
    }
    function renderTickets(tickets) {
        const ticketList = document.getElementById('ticketList');
        ticketList.innerHTML = '';
        tickets.forEach(ticket => {
            const card = document.createElement('div');
            card.className = 'ticket-card';
            card.innerHTML = `
                    <h4>è½¦ç¥¨IDï¼š${ticket.id}</h4>
                    <p>ä¹˜å®¢ï¼š${ticket.name}</p>
                    <p>è·¯çº¿ï¼š${ticket.route}</p>
                    <p>å¹´é¾„ï¼š${ticket.age}</p>
                    <p>ç›®çš„åœ°ï¼š${ticket.dest}</p>
                    <p>å‡ºè¡Œç›®çš„ï¼š${ticket.purpose}</p>
                `;
            ticketList.appendChild(card);
        });
    }
    function confirmTicketFilter() {
        const activeFilter = document.querySelector('.filter-btn.active').getAttribute('data-type');
        const filterName = {
            'all': 'å…¨éƒ¨è½¦ç¥¨',
            'route': 'åŒç¨‹åˆ†ç±»',
            'age': 'å¹´é¾„åˆ†ç±»',
            'dest': 'ç›®çš„åœ°åˆ†ç±»',
            'purpose': 'ç›®çš„åˆ†ç±»'
        };
        alert(`è½¦ç¥¨åˆ†ç±»ç¡®è®¤æˆåŠŸï¼å½“å‰é€‰ä¸­ï¼š${filterName[activeFilter]}`);
        stepStatus.step2Done = true;
        stepBar.className = 'step-bar step-3';
        stepItems[1].classList.remove('active');
        stepItems[1].classList.add('done');
        stepItems[2].classList.add('active');
        document.getElementById('nav3').classList.remove('disabled');
        document.getElementById('nav3').click();
    }

    // ========== é˜¶æ®µä¸‰ï¼šæ ¸å¿ƒåŠŸèƒ½ - åœ°å›¾&è·¯çº¿è§„åˆ’ ==========
    // åˆå§‹åŒ–æ¸¸æˆæ•°æ®
    function initGameData() {
        // æ¸²æŸ“åœ¨çº¿ç”¨æˆ·
        renderOnlineUsers('all');
        // æ¸²æŸ“èŠå¤©æ¶ˆæ¯
        const chatMessages = document.getElementById('chatMessages');
        chatMessages.innerHTML = '';
        chatData.forEach(msg => {
            addChatMsg(msg.sender, msg.content, msg.isSelf);
        });
        // è·¯çº¿/ç›®çš„åœ°åˆ†ç±»ç­›é€‰
        const routeFilterBtns = document.querySelectorAll('.route-filter-btn');
        routeFilterBtns.forEach(btn => {
            btn.addEventListener('click', () => {
                routeFilterBtns.forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                const filterType = btn.getAttribute('data-filter');
                renderOnlineUsers(filterType);
            });
        });
    }

    // è‡ªåŠ¨è§„åˆ’è·¯çº¿ï¼ˆç²¾å‡†ç»è¿‡æ‰€æœ‰èŠ‚ç‚¹ï¼‰
    let isRouting = false; // çŠ¶æ€é”ï¼šé˜²æ­¢é‡å¤ç‚¹å‡»è§¦å‘
    function planRoute() {
        // 1. é˜²æ­¢é‡å¤è§¦å‘ï¼šå¦‚æœæ­£åœ¨è§„åˆ’ï¼Œç›´æ¥è¿”å›
        if (isRouting) return;
        isRouting = true;

        // 2. é‡ç½®ä¹‹å‰çš„è·¯çº¿å’ŒèŠ‚ç‚¹çŠ¶æ€ï¼ˆå…³é”®ä¿®å¤ï¼‰
        document.getElementById('routePath').style.opacity = '0'; // éšè—åŸæœ‰è·¯çº¿
        document.querySelectorAll('.map-node').forEach(node => {
            node.classList.remove('highlight'); // å–æ¶ˆæ‰€æœ‰èŠ‚ç‚¹é«˜äº®
        });

        // 3. é‡æ–°è®¡ç®—çš„èŠ‚ç‚¹åæ ‡ï¼ˆå…¨éƒ¨åœ¨å®¹å™¨å†…ï¼‰
        const nodeCoords = {
            start: {x: 50, y: 50},
            kfc: {x: 120, y: 100},
            park: {x: 80, y: 180},
            toilet1: {x: 200, y: 250},
            rest1: {x: 250, y: 350},
            mcd: {x: 300, y: 300},
            mall: {x: 400, y: 450},
            rest2: {x: 500, y: 550},
            garden: {x: 550, y: 500},
            toilet2: {x: 500, y: 650},
            starbucks: {x: 550, y: 600},
            end: {x: 600, y: 650}
        };

        // 4. ç”Ÿæˆå¹¶æ˜¾ç¤ºæ–°è·¯çº¿
        const pathD = `
        M ${nodeCoords.start.x} ${nodeCoords.start.y}
        L ${nodeCoords.kfc.x} ${nodeCoords.kfc.y}
        L ${nodeCoords.park.x} ${nodeCoords.park.y}
        L ${nodeCoords.toilet1.x} ${nodeCoords.toilet1.y}
        L ${nodeCoords.rest1.x} ${nodeCoords.rest1.y}
        L ${nodeCoords.mcd.x} ${nodeCoords.mcd.y}
        L ${nodeCoords.mall.x} ${nodeCoords.mall.y}
        L ${nodeCoords.rest2.x} ${nodeCoords.rest2.y}
        L ${nodeCoords.garden.x} ${nodeCoords.garden.y}
        L ${nodeCoords.starbucks.x} ${nodeCoords.starbucks.y}
        L ${nodeCoords.toilet2.x} ${nodeCoords.toilet2.y}
        L ${nodeCoords.end.x} ${nodeCoords.end.y}
    `;
        document.getElementById('routePath').setAttribute('d', pathD);
        document.getElementById('routePath').style.opacity = '1';
        document.getElementById('routeAnimation').beginElement();

        // 5. åŒæ­¥é«˜äº®èŠ‚ç‚¹
        const nodes = document.querySelectorAll('.map-node');
        nodes.forEach((node, index) => {
            setTimeout(() => {
                node.classList.add('highlight');
            }, index * 250);
        });

        // 6. è·¯çº¿æç¤ºå¼¹çª—ï¼ˆä»…å¼¹å‡ºä¸€æ¬¡ï¼‰
        setTimeout(() => {
            alert(`âœ… ç¯çƒæ¸¯â†’ä½˜å±± æœ€ä¼˜è·¯çº¿è§„åˆ’å®Œæˆï¼
ğŸ“Œ å…¨ç¨‹é€”ç»ç‚¹ï¼ˆæŒ‰é¡ºåºï¼‰ï¼š
1. èµ·ç‚¹ï¼šç¯çƒæ¸¯
2. å•†ä¸šåº—ï¼šè‚¯å¾·åŸºï¼ˆç¯çƒæ¸¯åº—ï¼‰
3. æ™¯ç‚¹ï¼šé•¿é£å…¬å›­ï¼ˆå¯ç‚¹å‡»æŸ¥çœ‹è¯¦æƒ…ï¼‰
4. å…¬å…±è®¾æ–½ï¼šå…¬å…±å•æ‰€ï¼ˆæ™®é™€ï¼‰
5. å…¬å…±è®¾æ–½ï¼šä¼‘æ¯ç«™ï¼ˆæ™®é™€æ®µï¼‰
6. å•†ä¸šåº—ï¼šéº¦å½“åŠ³ï¼ˆè™¹æ¡¥åº—ï¼‰
7. æ™¯ç‚¹ï¼šè™¹æ¡¥å¤©åœ°ï¼ˆå¯ç‚¹å‡»æŸ¥çœ‹è¯¦æƒ…ï¼‰
8. å…¬å…±è®¾æ–½ï¼šä¼‘æ¯ç«™ï¼ˆæ¾æ±Ÿæ®µï¼‰
9. æ™¯ç‚¹ï¼šä¸Šæµ·è¾°å±±æ¤ç‰©å›­ï¼ˆå¯ç‚¹å‡»æŸ¥çœ‹è¯¦æƒ…ï¼‰
10. å•†ä¸šåº—ï¼šæ˜Ÿå·´å…‹ï¼ˆä½˜å±±åº—ï¼‰
11. å…¬å…±è®¾æ–½ï¼šå…¬å…±å•æ‰€ï¼ˆæ¾æ±Ÿï¼‰
12. ç»ˆç‚¹ï¼šä½˜å±±å›½å®¶æ£®æ—å…¬å›­

ğŸ—ºï¸ è·¯çº¿ä¿¡æ¯ï¼š
â€¢ å…¨ç¨‹çº¦30kmï¼Œé¢„è®¡è¡Œç¨‹1.5å°æ—¶
â€¢ é€”ç»3ä¸ªæ ¸å¿ƒæ™¯ç‚¹ã€2ä¸ªå…¬å…±å•æ‰€ã€2ä¸ªä¼‘æ¯ç«™ã€3ä¸ªå•†ä¸šåº—
â€¢ ç‚¹å‡»è·¯çº¿ä¸Šçš„èŠ‚ç‚¹ï¼Œå¯æŸ¥çœ‹å¯¹åº”åœ°ç‚¹è¯¦æƒ…
â€¢ åŒè·¯çº¿ç”¨æˆ·å·²å®æ—¶åŒæ­¥ï¼Œå¯åœ¨å³ä¾§é¢æ¿äº’åŠ¨äº¤æµï½`);
            // 7. è§„åˆ’å®Œæˆï¼Œé‡Šæ”¾çŠ¶æ€é”
            isRouting = false;
        }, 3000);
    }

    // æ¸²æŸ“åœ¨çº¿ç”¨æˆ·ï¼ˆæ ¸å¿ƒéœ€æ±‚4+5ï¼‰
    function renderOnlineUsers(filterType) {
        const userList = document.getElementById('onlineUserList');
        userList.innerHTML = '';
        let filteredUsers = userData;
        // è‡ªåŠ¨åˆ†ç±»ç­›é€‰
        if (filterType === 'sameRoute') {
            filteredUsers = userData.filter(u => u.route === 'ç¯çƒæ¸¯â†’ä½˜å±±');
        } else if (filterType === 'sameDest') {
            filteredUsers = userData.filter(u => u.dest === 'ä½˜å±±');
        }
        // æ¸²æŸ“ç”¨æˆ·åˆ—è¡¨
        filteredUsers.forEach(user => {
            const userItem = document.createElement('div');
            // æ ‡è®°åŒè·¯çº¿ç”¨æˆ·
            const isSameRoute = user.route === 'ç¯çƒæ¸¯â†’ä½˜å±±';
            userItem.className = `user-item ${isSameRoute ? 'same-route' : ''}`;
            userItem.innerHTML = `
                    <div class="user-avatar">${user.avatar}</div>
                    <div>
                        <p><strong>${user.name}</strong></p>
                        <p class="user-route">è·¯çº¿ï¼š${user.route} | ç›®çš„åœ°ï¼š${user.dest}</p>
                    </div>
                    ${isSameRoute ? '<div class="user-tag">åŒè·¯çº¿</div>' : ''}
                `;
            // ç‚¹å‡»ç”¨æˆ·è§¦å‘äº’åŠ¨
            userItem.addEventListener('click', () => {
                document.querySelectorAll('.user-item').forEach(item => item.style.background = '');
                userItem.style.background = '#f8f9fa';
                addChatMsg(user.name, `ä½ å¥½ï¼æˆ‘ä¹Ÿæ˜¯å»${user.dest}çš„ï¼Œèµ°${user.route}è·¯çº¿ï½`, false);
            });
            userList.appendChild(userItem);
        });
    }

    // æ™¯ç‚¹ä»‹ç»ï¼ˆæ ¸å¿ƒéœ€æ±‚2ï¼‰
    function showScenicModal(name) {
        const modal = document.getElementById('scenicModal');
        const scenic = scenicData[name] || scenicData['ä½˜å±±å›½å®¶æ£®æ—å…¬å›­'];
        document.getElementById('scenicName').innerText = name;
        document.getElementById('scenicImg').src = scenic.img;
        document.getElementById('scenicDesc').innerText = scenic.desc;
        document.getElementById('scenicRouteTips').innerText = scenic.routeTips;
        modal.style.display = 'block';
    }
    function closeScenicModal() {
        document.getElementById('scenicModal').style.display = 'none';
    }

    // è§’è‰²äº’åŠ¨ï¼ˆæ ¸å¿ƒéœ€æ±‚6ï¼‰
    function addChatMsg(sender, content, isSelf) {
        const chatMessages = document.getElementById('chatMessages');
        const msg = document.createElement('div');
        msg.className = `chat-msg ${isSelf ? 'msg-self' : 'msg-other'}`;
        msg.innerHTML = `<strong>${sender}ï¼š</strong>${content}`;
        chatMessages.appendChild(msg);
        chatMessages.scrollTop = chatMessages.scrollHeight;
    }
    function sendChat() {
        const input = document.getElementById('chatInput');
        const content = input.value.trim();
        if (!content) return;
        addChatMsg('æˆ‘', content, true);
        input.value = '';
        // æ¨¡æ‹ŸåŒè·¯çº¿ç”¨æˆ·å›å¤
        setTimeout(() => {
            const sameRouteUsers = userData.filter(u => u.route === 'ç¯çƒæ¸¯â†’ä½˜å±±');
            const randomUser = sameRouteUsers[Math.floor(Math.random() * sameRouteUsers.length)];
            const replies = [
                `æˆ‘åˆšåˆ°${randomUser.route.split('â†’')[0]}ï¼Œä¸€èµ·èµ°å—ï¼Ÿ`,
                `${content}ï¼æˆ‘ä¹Ÿè§‰å¾—è¿™æ¡è·¯çº¿ä¸Šçš„è¾°å±±æ¤ç‰©å›­è¶…ç¾ï½`,
                `æé†’ä¸€ä¸‹ï¼Œè·¯çº¿ä¸Šçš„æ™®é™€ä¼‘æ¯ç«™æœ‰å…è´¹é¥®ç”¨æ°´å“¦ï¼`,
                `æˆ‘å·²ç»åˆ°ç»ˆç‚¹äº†ï¼Œä½˜å±±çš„é£æ™¯è¶…æ£’ï¼Œå¿«è¿‡æ¥ï¼`
            ];
            const randomReply = replies[Math.floor(Math.random() * replies.length)];
            addChatMsg(randomUser.name, randomReply, false);
        }, 1000);
    }

    // ========== åˆå§‹åŒ– ==========
    window.onload = function() {
        initTicketList();
    };
</script>
</body>
</html>



